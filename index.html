<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Уличный текстовый визуализатор</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            font-family: 'Arial', sans-serif;
            position: relative;
        }
        
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
        }
        
        .control-btn {
            padding: 8px 15px;
            background: #222;
            border: 1px solid #444;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: #333;
            border-color: #666;
        }
        
        .info-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            color: #aaa;
        }
        
        .title {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            font-size: 18px;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div class="title">Уличный текстовый визуализатор</div>
    
    <div class="info-panel">
        <div>Частиц: <span id="particle-count">0</span></div>
        <div>FPS: <span id="fps">0</span></div>
    </div>
    
    <div class="controls">
        <button class="control-btn" id="mode-btn">Режим: Симметрия</button>
        <button class="control-btn" id="density-up">+ Плотность</button>
        <button class="control-btn" id="density-down">- Плотность</button>
        <button class="control-btn" id="speed-up">+ Скорость</button>
        <button class="control-btn" id="speed-down">- Скорость</button>
    </div>

    <audio id="audio-element" loop>
        <source src="https://assets.mixkit.co/music/preview/mixkit-ambient-basic-loop-315.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Массив уличных надписей и объявлений
        const STREET_TEXTS = [
            "КУПЛЮ ВОЛОСЫ", "РАЗВАЛ СХОЖДЕНИЕ", "ПОМОЩЬ В ТЯЖЕЛОЙ СИТУАЦИИ",
            "НАРКОМАНИЯ АЛКОГОЛИЗМ", "СТОМАТОЛОГИЯ", "МАГНИТ НЕ ПРИСЛОНЯТЬСЯ",
            "ПРОКАТ КОНЬКОВ", "ОБМЕН КВАРТИР", "СДАМ ГАРАЖ", "РЕМОНТ ТЕЛЕФОНОВ",
            "ВЫЗОВ ТАКСИ", "ПРОПАЛ КОТ", "СУШИ ПИЦЦА", "WI-FI БЕСПЛАТНО",
            "ЗДЕСЬ БЫЛ ВАСЯ", "ОСТОРОЖНО ДВЕРЬ", "ВХОД С ЗАДНЕГО КРЫЛЬЦА",
            "ОБЪЕЗД СЛЕВА", "ПРОЕЗД ЗАПРЕЩЕН", "ПОСТОРОННИМ ВХОД ВОСПРЕЩЕН",
            "АКЦИЯ СКИДКА", "РАСПРОДАЖА", "ТОВАРЫ ДЛЯ ДОМА", "КЛУБНИКА ОПТОМ",
            "РЕКЛАМНАЯ ПАУЗА", "ДОБРО ПОЖАЛОВАТЬ", "ВЫХОД", "ЗАКРЫТО НА ПЕРЕРЫВ",
            "ОЖИДАНИЕ 15 МИНУТ", "НЕТ МЕСТ", "ЗАНЯТО", "СВОБОДНО", "КАССА",
            "НЕ КУРИТЬ", "НЕ СОРИТЬ", "ПОСТОЯННО ИЩУТСЯ", "ТРЕБУЮТСЯ РАБОЧИЕ",
            "УТЮЖЕНИЕ БЕЛЬЯ", "ЧИСТКА ОБУВИ", "РЕМОНТ ОБУВИ", "КЛЮЧИ ОТ КВАРТИРЫ",
            "ПОТЕРЯЛСЯ ПАСПОРТ", "ВОЗЬМУ В ДОЛГ", "ДАМ В ДОЛГ", "МЕНЯЮ",
            "ПРОДАМ ДИВАН", "КУПЛЮ ХОЛОДИЛЬНИК", "БУДЬ ОСТОРОЖЕН", "НЕ ВЛЕЗАЙ УБЬЕТ",
            "ОБЪЯВЛЕНИЯ", "РЕКЛАМА", "ПРЯМОЙ ЭФИР", "НОВОСТИ", "ПОГОДА",
            "КУРС ВАЛЮТ", "СКОРО ОТКРЫТИЕ", "ЗАКРЫТО НА САНИТАРНЫЙ ДЕНЬ"
        ];

        // Конфигурация
        const CONFIG = {
            particleCount: 100,
            maxParticles: 500,
            minParticles: 50,
            particleSize: 14,
            speed: 1,
            symmetryMode: 2, // 0 - нет симметрии, 1 - горизонтальная, 2 - вертикальная, 3 - обе
            colorPalette: [
                '#ff4444', '#44ff44', '#4444ff', '#ffff44', '#ff44ff', '#44ffff',
                '#ff8844', '#8844ff', '#44ff88', '#ff4488', '#88ff44', '#4488ff'
            ],
            textChangeInterval: 3000,
            spawnRate: 5
        };

        // Состояние
        let state = {
            particles: [],
            lastTime: 0,
            fps: 0,
            frameCount: 0,
            lastFpsUpdate: 0,
            audioContext: null,
            analyser: null,
            audioData: null,
            isPlaying: false
        };

        // Элементы DOM
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const audioElement = document.getElementById('audio-element');
        const particleCountEl = document.getElementById('particle-count');
        const fpsEl = document.getElementById('fps');
        const modeBtn = document.getElementById('mode-btn');
        const densityUpBtn = document.getElementById('density-up');
        const densityDownBtn = document.getElementById('density-down');
        const speedUpBtn = document.getElementById('speed-up');
        const speedDownBtn = document.getElementById('speed-down');

        // Инициализация
        function init() {
            resizeCanvas();
            createParticles();
            setupEventListeners();
            setupAudio();
            
            // Запуск анимации
            requestAnimationFrame(animate);
        }

        // Создание частиц
        function createParticles() {
            state.particles = [];
            
            for (let i = 0; i < CONFIG.particleCount; i++) {
                addParticle();
            }
        }

        // Добавление новой частицы
        function addParticle() {
            const text = STREET_TEXTS[Math.floor(Math.random() * STREET_TEXTS.length)];
            const color = CONFIG.colorPalette[Math.floor(Math.random() * CONFIG.colorPalette.length)];
            
            state.particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                text: text,
                size: CONFIG.particleSize + Math.random() * 10 - 5,
                color: color,
                speed: CONFIG.speed * (0.5 + Math.random()),
                life: 1,
                targetX: Math.random() * canvas.width,
                targetY: Math.random() * canvas.height,
                opacity: 0,
                maxOpacity: 0.7 + Math.random() * 0.3
            });
        }

        // Настройка обработчиков событий
        function setupEventListeners() {
            // Изменение размера окна
            window.addEventListener('resize', resizeCanvas);
            
            // Кнопки управления
            modeBtn.addEventListener('click', () => {
                CONFIG.symmetryMode = (CONFIG.symmetryMode + 1) % 4;
                updateModeButtonText();
            });
            
            densityUpBtn.addEventListener('click', () => {
                CONFIG.particleCount = Math.min(CONFIG.maxParticles, CONFIG.particleCount + 50);
                createParticles();
            });
            
            densityDownBtn.addEventListener('click', () => {
                CONFIG.particleCount = Math.max(CONFIG.minParticles, CONFIG.particleCount - 50);
                createParticles();
            });
            
            speedUpBtn.addEventListener('click', () => {
                CONFIG.speed = Math.min(5, CONFIG.speed + 0.5);
            });
            
            speedDownBtn.addEventListener('click', () => {
                CONFIG.speed = Math.max(0.5, CONFIG.speed - 0.5);
            });
            
            // Запуск/остановка аудио по клику
            canvas.addEventListener('click', toggleAudio);
        }

        // Обновление текста кнопки режима
        function updateModeButtonText() {
            const modes = ["Без симметрии", "Горизонтальная", "Вертикальная", "Двойная"];
            modeBtn.textContent = `Режим: ${modes[CONFIG.symmetryMode]}`;
        }

        // Изменение размера canvas
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        // Настройка аудио
        function setupAudio() {
            try {
                state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                state.analyser = state.audioContext.createAnalyser();
                state.analyser.fftSize = 256;
                
                const source = state.audioContext.createMediaElementSource(audioElement);
                source.connect(state.analyser);
                state.analyser.connect(state.audioContext.destination);
                
                state.audioData = new Uint8Array(state.analyser.frequencyBinCount);
                
                audioElement.volume = 0.3;
            } catch (e) {
                console.log("Аудио API не поддерживается", e);
            }
        }

        // Переключение аудио
        function toggleAudio() {
            if (state.audioContext) {
                if (state.isPlaying) {
                    audioElement.pause();
                    state.isPlaying = false;
                } else {
                    audioElement.play();
                    state.audioContext.resume();
                    state.isPlaying = true;
                }
            }
        }

        // Анимация
        function animate(time) {
            requestAnimationFrame(animate);
            
            // Расчет FPS
            state.frameCount++;
            if (time - state.lastFpsUpdate >= 1000) {
                state.fps = Math.round(state.frameCount * 1000 / (time - state.lastFpsUpdate));
                state.lastFpsUpdate = time;
                state.frameCount = 0;
                fpsEl.textContent = state.fps;
                particleCountEl.textContent = state.particles.length;
            }
            
            // Обновление данных аудио
            if (state.analyser && state.isPlaying) {
                state.analyser.getByteFrequencyData(state.audioData);
            }
            
            // Очистка canvas
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Добавление новых частиц
            if (state.particles.length < CONFIG.particleCount && Math.random() < 0.1 * CONFIG.spawnRate) {
                addParticle();
            }
            
            // Обновление и отрисовка частиц
            updateParticles(time);
            
            state.lastTime = time;
        }

        // Обновление частиц
        function updateParticles(time) {
            for (let i = state.particles.length - 1; i >= 0; i--) {
                const p = state.particles[i];
                
                // Движение к целевой точке
                p.x += (p.targetX - p.x) * 0.01 * p.speed;
                p.y += (p.targetY - p.y) * 0.01 * p.speed;
                
                // Изменение непрозрачности
                if (p.opacity < p.maxOpacity) {
                    p.opacity += 0.01;
                }
                
                // Уменьшение времени жизни
                p.life -= 0.001;
                
                // Если частица умерла, удаляем ее
                if (p.life <= 0) {
                    state.particles.splice(i, 1);
                    continue;
                }
                
                // Отрисовка частицы
                drawParticle(p);
                
                // Отрисовка симметричных отражений
                if (CONFIG.symmetryMode === 1 || CONFIG.symmetryMode === 3) {
                    // Горизонтальная симметрия
                    drawParticle({
                        ...p,
                        x: canvas.width - p.x
                    });
                }
                
                if (CONFIG.symmetryMode === 2 || CONFIG.symmetryMode === 3) {
                    // Вертикальная симметрия
                    drawParticle({
                        ...p,
                        y: canvas.height - p.y
                    });
                }
                
                if (CONFIG.symmetryMode === 3) {
                    // Двойная симметрия
                    drawParticle({
                        ...p,
                        x: canvas.width - p.x,
                        y: canvas.height - p.y
                    });
                }
            }
        }

        // Отрисовка частицы
        function drawParticle(p) {
            ctx.save();
            ctx.globalAlpha = p.opacity * p.life;
            ctx.font = `${p.size}px Arial`;
            ctx.fillStyle = p.color;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(p.text, p.x, p.y);
            ctx.restore();
        }

        // Запуск при загрузке
        window.addEventListener('load', init);
        updateModeButtonText();
    </script>
</body>
</html>
